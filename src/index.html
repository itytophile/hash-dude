<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Websocket Chat</title>
</head>

<body>
    <h1>Websocket Chat Example</h1>

    <input id="username" style="display:block; width:100px; box-sizing: border-box" type="text" placeholder="username">
    <button id="join-btn" type="button">Join Chat</button>
    <textarea id="chat" style="display:block; width:600px; height:400px; box-sizing: border-box" cols="30"
        rows="10"></textarea>
    <input id="input" style="display:block; width:600px; box-sizing: border-box" type="text" placeholder="chat">

    <script>
        const username = document.getElementById("username");
        const join_btn = document.getElementById("join-btn");
        const textarea = document.getElementById("chat");
        const input = document.getElementById("input");

        join_btn.onclick = (e) => {
            join_btn.disabled = true;

            const websocket = new WebSocket(`ws://${window.location.host}/ws`);

            websocket.onopen = () => {
                console.log("connection opened");
                websocket.send(username.value);
            }

            websocket.onclose = () => {
                console.log("connection closed");
                join_btn.disabled = false;
            }

            websocket.onmessage = (e) => {
                console.log("received message: " + e.data);
                textarea.value += e.data + "\r\n";
            }

            input.onkeydown = (e) => {
                if (e.key == "Enter") {
                    websocket.send(input.value);
                    input.value = "";
                }
            }
        }
    </script>
</body>

</html>